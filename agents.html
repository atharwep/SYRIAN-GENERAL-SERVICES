<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุจูุงุจุฉ ุงููููุงุก - ุดุญู ูุณุญุจ ุงูููุงุท</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <nav class="glass-nav">
        <a href="index.html" class="logo-container">
            <div class="logo-box">ุจ</div>
            <div style="font-weight: 900; font-size: 18px;">ุจูุงุจุฉ ุงูุฎุฏูุงุช ุงูุนุงูุฉ</div>
        </a>
        <div class="nav-links" id="nav-menu">
            <a href="dashboard.html">ููุญุฉ ุงูุชุญูู</a>
            <a href="agents.html" class="active">ุจูุงุจุฉ ุงููููุงุก</a>
        </div>
        <div id="nav-right" style="display: flex; align-items: center; gap: 15px;"></div>
        <div class="menu-toggle" id="mobile-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="container" style="padding-top: 50px;">
        <div class="text-center mb-2" style="margin-bottom: 50px;">
            <h1 style="font-weight: 950; font-size: 2.8rem;">ูุธุงู ุงููููุงุก ูุงูููุฒุนูู</h1>
            <p style="color: #64748B; font-weight: 700; font-size: 1.1rem;">ุฅุฏุงุฑุฉ ุนูููุงุช ุงูุณุญุจ ูุงูุฅูุฏุงุน ูููุดุชุฑููู ุจูู
                ุณูููุฉ ูุฃูุงู</p>
        </div>

        <div class="sidebar-layout">
            <main>
                <!-- Agent Transaction Tool -->
                <div class="card" style="padding: 40px; border: 2px solid var(--gold);">
                    <h3 style="font-weight: 900; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">๐ณ
                        ุชูููุฐ ุนูููุฉ (ุดุญู / ุณุญุจ)</h3>

                    <div id="status-msg"
                        style="display: none; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-weight: 800; text-align: center;">
                    </div>

                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>ุฑูู ูุงุชู ุงููุณุชุฎุฏู</label>
                            <input type="text" id="target-phone" class="form-input" placeholder="09xxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>ุนุฏุฏ ุงูููุงุท</label>
                            <input type="number" id="points-amount" class="form-input" placeholder="ุฃุฏุฎู ุงููููุฉ">
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button onclick="processAction('DEPOSIT')" class="btn btn-primary"
                            style="flex: 1; padding: 18px; font-size: 1.1rem; background: #16a34a; border-radius: 20px;">๐ฅ
                            ุฅูุฏุงุน (ุดุญู ููุงุท)</button>
                        <button onclick="processAction('WITHDRAW')" class="btn btn-outline"
                            style="flex: 1; padding: 18px; font-size: 1.1rem; border: 2px solid #dc2626; color: #dc2626; border-radius: 20px;">๐ค
                            ุณุญุจ (ูุจุถ ูุงุด)</button>
                    </div>

                    <div
                        style="margin-top: 30px; padding: 20px; background: #F8FAFC; border-radius: 20px; border: 1px dashed #CBD5E1;">
                        <p style="font-size: 0.8rem; font-weight: 800; color: #64748B; line-height: 1.6;">
                            โ๏ธ ููุงุญุธุฉ: ูุง ูููู ุงูุชุฑุงุฌุน ุนู ุงูุนูููุฉ ุจุนุฏ ุชูููุฐูุง. ูุฑุฌู ุงูุชุฃูุฏ ูู ุฑูู ุงููุงุชู ูุตุญุฉ ุงููุจูุบ
                            ุงููุณุชูู ูู ุงููุดุชุฑู ูุจู ุงูุถุบุท ุนูู ุงูุชูููุฐ.
                        </p>
                    </div>
                </div>
            </main>

            <aside>
                <div class="card">
                    <h3 style="font-weight: 900; margin-bottom: 20px;">ุงูุนูููุงุช ุงูุฃุฎูุฑุฉ ููููุงูุฉ</h3>
                    <div id="agent-logs" style="text-align: center; padding: 30px 0; color: #94A3B8;">
                        <p style="font-weight: 800; font-size: 0.9rem;">ุจุงูุชุธุงุฑ ุชูููุฐ ุฃูู ุนูููุฉ...</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 25px; background: #FFFBEB;">
                    <h4 style="font-weight: 900; margin-bottom: 15px;">ุฏุนู ุงููููุงุก</h4>
                    <p style="font-size: 0.8rem; font-weight: 700; color: #92400E;">ูุทูุจ ุฒูุงุฏุฉ ุฑุตูุฏ ููุงูุฉ ุฃู ุงูุฅุจูุงุบ ุนู
                        ูุดููุฉ ูููุฉุ ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฅุฏุงุฑุฉ ุงูุฑุฆูุณูุฉ.</p>
                </div>
            </aside>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        function processAction(type) {
            const phone = document.getElementById('target-phone').value;
            const points = parseInt(document.getElementById('points-amount').value);
            const status = document.getElementById('status-msg');

            if (!phone || isNaN(points) || points <= 0) {
                showMsg("ูุฑุฌู ุฅุฏุฎุงู ุฑูู ูุงุชู ุตุญูุญ ููููุฉ ููุงุท ุตุงูุญุฉ", "#fee2e2", "#dc2626");
                return;
            }

            // For withdrawal, points are deducted from user (negative for the system to subtract)
            const finalAmount = (type === 'DEPOSIT') ? points : -points;
            const title = (type === 'DEPOSIT') ? "ุฅูุฏุงุน ููุงุท ุนุจุฑ ูููู" : "ุณุญุจ ููุงุท ุนุจุฑ ูููู";

            const result = Store.updateUserBalance(phone, finalAmount, title);

            if (result.success) {
                showMsg(`ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ! ุงูุฑุตูุฏ ุงูุฌุฏูุฏ ูููุดุชุฑู: ${result.newBalance} ููุทุฉ`, "#dcfce7", "#16a34a");
                UI.updateNavbar();
                addLog(phone, type, points);
            } else {
                showMsg(result.message, "#fee2e2", "#dc2626");
            }
        }

        function showMsg(text, bg, color) {
            const status = document.getElementById('status-msg');
            status.style.display = 'block';
            status.style.backgroundColor = bg;
            status.style.color = color;
            status.innerText = text;
        }

        function addLog(phone, type, points) {
            const list = document.getElementById('agent-logs');
            if (list.innerHTML.includes('ุจุงูุชุธุงุฑ')) list.innerHTML = '';

            const time = new Date().toLocaleTimeString('ar-SY');
            list.innerHTML = `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; font-weight: 700;">
                    <span>${phone}</span>
                    <span style="color: ${type === 'DEPOSIT' ? '#16a34a' : '#dc2626'}">${type === 'DEPOSIT' ? '+' : '-'}${points}</span>
                </div>
            ` + list.innerHTML;
        }

        // Restrict access to Agents and Admins only
        document.addEventListener('DOMContentLoaded', () => {
            if (Store.user && Store.user.role !== 'AGENT' && Store.user.role !== 'ADMIN') {
                alert('ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ูููููุงุก ูุงูููุฒุนูู ููุท');
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>

</html>