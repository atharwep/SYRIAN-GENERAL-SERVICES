<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© - Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .pharmacy-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-rgba);
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 25px;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .pharmacy-card:hover {
            background: rgba(16, 185, 129, 0.05);
            border-color: #10b981;
            transform: scale(1.02);
        }

        .pharmacy-icon {
            width: 70px;
            height: 70px;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            flex-shrink: 0;
        }

        .shift-badge {
            background: rgba(197, 160, 33, 0.1);
            color: var(--gold);
            padding: 4px 12px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 800;
            display: inline-block;
            margin-top: 8px;
        }

        .status-on-call {
            color: #10b981;
            font-size: 0.7rem;
            font-weight: 950;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-on-call::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 10px #10b981;
            animation: pulseGreen 2s infinite;
        }

        @keyframes pulseGreen {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }

            100% {
                opacity: 1;
            }
        }

        .action-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: 0.3s;
            cursor: pointer;
        }

        .action-circle:hover {
            background: #10b981;
            transform: rotate(15deg);
        }
    </style>
</head>

<body class="royal-dark">
    <nav class="glass-nav">
        <a href="dashboard.html" class="logo-container">
            <div class="logo-box">
                <img src="assets/logo.png" alt="Moamalaty">
            </div>
            <div>
                <div style="font-weight: 950; font-size: 20px; color: white;">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª <span
                        style="font-size: 12px; color: var(--gold);">Moamalaty Health</span></div>
                <div style="font-size: 8px; color: var(--gold); font-weight: 800; letter-spacing: 1px;">MEDICAL SUPPORT
                </div>
            </div>
        </a>
        <div id="nav-right" style="display: flex; align-items: center; gap: 15px;">
            <button onclick="UIManager.toggleLanguage()" class="btn-icon">ğŸŒ</button>
            <button onclick="UIManager.toggleTheme()" class="btn-icon">ğŸŒ—</button>
        </div>
    </nav>

    <div class="container" style="padding-top: 50px;">
        <div class="mb-5">
            <div
                style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                <div>
                    <h1 style="font-weight: 950; font-size: 3rem; color: white; margin-bottom: 5px;">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©
                    </h1>
                    <p style="color: var(--text-muted); font-weight: 700;">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ (Ù„ÙŠÙ„Ø§Ù‹
                        ÙˆÙ†Ù‡Ø§Ø±Ø§Ù‹)</p>
                </div>
                <div
                    style="background: rgba(255, 255, 255, 0.05); padding: 10px 20px; border-radius: 20px; border: 1px solid var(--border-rgba);">
                    <p style="color: var(--gold); font-weight: 900; font-size: 0.8rem; margin: 0;">Ø§Ù„ÙŠÙˆÙ…: <span
                            id="current-day" style="color: white;">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</span></p>
                    <p id="current-date" style="color: #94a3b8; font-size: 0.7rem; font-weight: 700; margin: 0;">9
                        ÙØ¨Ø±Ø§ÙŠØ± 2026</p>
                </div>
            </div>
        </div>

        <div class="grid sidebar-layout">
            <main>
                <div class="card" style="margin-bottom: 25px; padding: 20px;">
                    <div class="grid grid-3" style="gap: 15px;">
                        <div>
                            <label class="form-label" style="font-size: 0.7rem;">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                            <select id="gov-search" class="form-input"
                                onchange="LocationHelper.initGovernorates('area-search', this.value); filterPharmacies();">
                                <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.7rem;">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                            <select id="area-search" class="form-input" onchange="filterPharmacies()">
                                <option value="">ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.7rem;">Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</label>
                            <input type="text" id="name-search" class="form-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©..."
                                onkeyup="filterPharmacies()">
                        </div>
                    </div>
                </div>

                <div id="pharmacies-list">
                    <!-- Dynamic -->
                </div>
            </main>

            <aside>
                <div class="card">
                    <h3 style="font-weight: 950; color: white; margin-bottom: 20px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div
                            style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 15px; border: 1px solid rgba(16, 185, 129, 0.2);">
                            <p style="color: #10b981; font-weight: 950; font-size: 0.85rem; margin-bottom: 5px;">ÙØªØ±Ø©
                                Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                            <p style="color: white; font-size: 0.75rem; font-weight: 700; margin: 0;">ØªØ¹Ù…Ù„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª
                                Ø§Ù„Ù…Ø¯Ø±Ø¬Ø© Ø­ØªÙ‰ Ø§Ù„Ø³Ø§Ø¹Ø© 8:00 ØµØ¨Ø§Ø­Ø§Ù‹ ØºØ¯Ø§Ù‹.</p>
                        </div>
                        <div
                            style="background: rgba(255, 255, 255, 0.02); padding: 15px; border-radius: 15px; border: 1px solid var(--border-rgba);">
                            <h4 style="color: var(--gold); font-weight: 900; margin-bottom: 10px; font-size: 0.85rem;">
                                ğŸ“ Ø£Ù‚Ø±Ø¨ ØµÙŠØ¯Ù„ÙŠØ© Ø¥Ù„ÙŠÙƒ</h4>
                            <p id="nearest-pharmacy" style="color: white; font-size: 0.8rem; font-weight: 700;">Ø¬Ø§Ø±ÙŠ
                                ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 25px; border-radius: 15px;"
                        onclick="Notify.show('Ø·Ù„Ø¨ Ø¯ÙˆØ§Ø¡', 'Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø© ØªÙˆØµÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹ ğŸ›µ', 'fas fa-truck')">
                        Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø²Ù„ÙŠ (Ù‚Ø±ÙŠØ¨Ø§Ù‹)
                    </button>
                </div>
            </aside>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/syria-data.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            LocationHelper.initGovernorates('gov-search');
            const data = await Store.getData('pharmacies');
            renderPharmacies(data || []);
            updateTimeInfo();
        });

        function updateTimeInfo() {
            const now = new Date();
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            document.getElementById('current-day').innerText = days[now.getDay()];
            document.getElementById('current-date').innerText = now.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        function renderPharmacies(data) {
            const list = document.getElementById('pharmacies-list');
            if (data.length === 0) {
                list.innerHTML = `<p style="text-align:center; color:gray; padding:40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙŠØ¯Ù„ÙŠØ§Øª Ù…Ù†Ø§ÙˆØ¨Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚</p>`;
                return;
            }

            list.innerHTML = data.map(p => `
                <div class="pharmacy-card">
                    <div class="pharmacy-icon">
                        <i class="fas fa-flask-medical"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h3 style="color: white; font-weight: 950; margin: 0;">${p.name}</h3>
                                <p style="color: #94a3b8; font-size: 0.8rem; font-weight: 700; margin: 4px 0;">${p.pharmacist}</p>
                            </div>
                            ${p.status === 'ON_CALL' ? '<span class="status-on-call">Ù…Ù†Ø§ÙˆØ¨Ø© Ø§Ù„Ø¢Ù†</span>' : '<span style="color:gray; font-size:0.7rem;">ØºÙŠØ± Ù…Ù†Ø§ÙˆØ¨Ø©</span>'}
                        </div>
                        <p style="color: #cbd5e1; font-size: 0.85rem; font-weight: 700; margin: 10px 0;">
                            <i class="fas fa-location-arrow" style="color: #10b981; margin-left: 5px;"></i>${p.location}
                        </p>
                        <span class="shift-badge">${p.shift}</span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <a href="tel:${p.phone}" class="action-circle" title="Ø§ØªØµØ§Ù„">
                            <i class="fas fa-phone"></i>
                        </a>
                        <div class="action-circle" onclick="window.open('https://www.google.com/maps?q=${p.coordinates.lat},${p.coordinates.lng}', '_blank')" title="Ø§Ù„Ù…ÙˆÙ‚Ø¹">
                            <i class="fas fa-map-location-dot"></i>
                        </div>
                    </div>
                </div>
            `).join('');

            const onCall = data.filter(p => p.status === 'ON_CALL');
            if (onCall.length > 0) {
                document.getElementById('nearest-pharmacy').innerText = onCall[0].name + " (" + onCall[0].location + ")";
            }
        }

        function filterPharmacies() {
            const gov = document.getElementById('gov-search').value;
            const area = document.getElementById('area-search').value.toLowerCase();
            const name = document.getElementById('name-search').value.toLowerCase();
            const all = Store.getData('pharmacies') || [];

            const filtered = all.filter(p =>
                (!gov || p.governorate === gov) &&
                (p.location.toLowerCase().includes(area) || area === '') &&
                (p.name.toLowerCase().includes(name) || name === '')
            );

            renderPharmacies(filtered);
        }
    </script>
</body>

</html>