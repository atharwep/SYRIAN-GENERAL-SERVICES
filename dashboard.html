<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .sidebar {
            background: white;
            border-radius: 30px;
            padding: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.04);
            height: fit-content;
        }

        .side-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            text-decoration: none;
            color: #64748B;
            font-weight: 800;
            border-radius: 18px;
            transition: all 0.3s;
            margin-bottom: 5px;
        }

        .side-link:hover,
        .side-link.active {
            background: #F0F4F8;
            color: var(--gold);
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-panel {
            background: #1e293b;
            color: white;
            border-radius: 25px;
            padding: 30px;
            margin-top: 30px;
        }
    </style>
</head>

<body>

    <nav class="glass-nav">
        <a href="index.html" class="logo-container">
            <div class="logo-box">Ø¨</div>
            <div style="font-weight: 900; font-size: 18px;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
        </a>

        <div class="nav-links" id="nav-menu">
            <a href="dashboard.html" class="active">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <a href="doctors.html">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</a>
            <a href="taxi.html">Ø§Ù„Ù†Ù‚Ù„</a>
            <a href="wallet.html">Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
        </div>

        <div id="nav-right" style="display: flex; align-items: center; gap: 15px;"></div>

        <div class="menu-toggle" id="mobile-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="container sidebar-layout">
        <aside class="sidebar">
            <div style="text-align: center; margin-bottom: 30px;">
                <img id="user-avatar" src=""
                    style="width: 80px; height: 80px; border-radius: 20px; border: 3px solid var(--gold); margin-bottom: 15px;">
                <h3 id="user-name" style="font-weight: 950; font-size: 1.1rem;">...</h3>
                <span id="role-badge"
                    style="background: var(--gold); color: white; padding: 4px 12px; border-radius: 50px; font-size: 9px; font-weight: 900;"></span>
            </div>
            <a href="dashboard.html" class="side-link active">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="doctors.html" class="side-link">ğŸ©º Ø­Ø¬Ø² Ø·Ø¨ÙŠ</a>
            <a href="taxi.html" class="side-link">ğŸš• Ø·Ù„Ø¨ ØªØ§ÙƒØ³ÙŠ</a>
            <a href="wallet.html" class="side-link">ğŸ’³ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
            <div id="extra-links"></div>
            <hr style="margin: 15px 0; border: none; border-top: 1px solid rgba(0,0,0,0.05);">
            <button onclick="Auth.logout()" class="side-link"
                style="width: 100%; border: none; background: none; cursor: pointer; text-align: right;">ğŸšª
                Ø®Ø±ÙˆØ¬</button>
        </aside>

        <main>
            <div id="admin-section" style="display: none;">
                <!-- Points Control -->
                <div class="admin-panel" style="margin-top: 0;">
                    <h3 style="font-weight: 900; margin-bottom: 25px; color: var(--gold);">ğŸ”± ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù†Ù‚Ø§Ø· +
                        ÙˆÙƒÙ„Ø§Ø¡)</h3>

                    <div id="admin-status"
                        style="display: none; padding: 12px; border-radius: 12px; margin-bottom: 20px; font-weight: 800; font-size: 0.8rem; text-align: center;">
                    </div>

                    <div class="registration-form"
                        style="max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px;">
                        <div class="grid grid-2" style="gap: 15px;">
                            <input type="text" id="admin-phone" class="form-input"
                                style="background: rgba(0,0,0,0.05); color: #000;" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                            <input type="number" id="admin-points" class="form-input"
                                style="background: rgba(0,0,0,0.05); color: #000;" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                        </div>
                        <select id="admin-currency" class="form-input"
                            style="background: rgba(0,0,0,0.05); margin-top: 10px; color: #000;">
                            <option value="SYP">Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ© (SYP)</option>
                            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                        </select>

                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="adminPoints('UP')" class="btn btn-primary" style="flex: 1.5;">Ø¥ÙŠØ¯Ø§Ø¹ Ø±ØµÙŠØ¯
                                (+)</button>
                            <button onclick="adminPoints('DOWN')" class="btn"
                                style="flex: 1; background: #dc2626; color: white;">Ø³Ø­Ø¨ (-)</button>
                        </div>
                    </div>

                    <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

                    <!-- Doctor Management -->
                    <h4 style="color: var(--gold); margin-bottom: 15px; font-weight: 900;">ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h4>
                    <div
                        style="background: rgba(255,255,255,0.02); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05);">
                        <input type="text" id="manage-doc-phone" class="form-input"
                            style="background: rgba(255,255,255,0.05); color: white; margin-bottom: 10px;"
                            placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø¨ÙŠØ¨">

                        <div class="grid grid-2" style="gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="edit-doc-spec" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                            <input type="text" id="edit-doc-price" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù†ØµÙŠ)">
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button onclick="editDoctor()" class="btn btn-primary"
                                style="flex: 1; font-size: 0.8rem;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœï¸</button>
                            <button onclick="deleteDoctor()" class="btn"
                                style="flex: 1; background: #dc2626; color: white; font-size: 0.8rem;">Ø­Ø°Ù Ø§Ù„Ø·Ø¨ÙŠØ¨
                                ğŸ—‘ï¸</button>
                        </div>
                    </div>

                    <!-- Doctor Approval -->
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 25px;">
                        <p style="font-size: 0.85rem; font-weight: 800; color: #94a3b8; flex: 1;">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¹Ø¶Ùˆ ÙƒØ·Ø¨ÙŠØ¨:
                        </p>
                        <button onclick="approveDoctor()" class="btn"
                            style="background: #2563eb; color: white; padding: 12px 30px; border-radius: 15px;">Ø§Ø¹ØªÙ…Ø§Ø¯
                            Ø·Ø¨ÙŠØ¨ ğŸ©º</button>
                    </div>

                    <div style="display: flex; gap: 15px; align-items: center;">
                        <p style="font-size: 0.85rem; font-weight: 800; color: #94a3b8; flex: 1;">ØªÙØ¹ÙŠÙ„ Ø±ØªØ¨Ø© ÙˆÙƒÙŠÙ„ Ù„Ù‡Ø°Ø§
                            Ø§Ù„Ø±Ù‚Ù…:</p>
                        <button onclick="activateAgent()" class="btn"
                            style="background: #16a34a; color: white; padding: 12px 30px; border-radius: 15px;">ØªÙØ¹ÙŠÙ„
                            ÙƒÙˆÙƒÙŠÙ„ Ø±Ø³Ù…ÙŠ âœ…</button>
                    </div>

                    <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

                    <!-- Financial Reports Link -->
                    <a href="reports.html" class="btn"
                        style="display: block; width: 100%; text-align: center; background:rgba(255,255,255,0.1); color: white; margin-top: 15px;">
                        ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
                    </a>
                </div>
            </div>

            <div class="grid grid-2" style="margin-top: 30px;">
                <div class="stat-card">
                    <div style="font-size: 30px;">â­ï¸</div>
                    <div>
                        <p style="font-size: 0.75rem; font-weight: 800; color: #64748B;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <h4 id="user-balance" style="font-size: 1.5rem; font-weight: 950; color: var(--gold);">0</h4>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 30px;">ğŸ›¡ï¸</div>
                    <div>
                        <p style="font-size: 0.75rem; font-weight: 800; color: #64748B;">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù†</p>
                        <h4 style="font-size: 1rem; font-weight: 950; color: #16a34a;">Ù…Ø­Ù…ÙŠ Ø¨Ø±Ù…Ø² SMS</h4>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 25px;">
                <h3 style="font-weight: 900; margin-bottom: 20px;">ğŸ•’ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                <div id="activities-list" style="text-align: center; padding: 20px; color: #64748B; font-weight: 700;">
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</div>
            </div>
        </main>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (Store.user) {
                document.getElementById('user-name').innerText = Store.user.name;
                document.getElementById('user-balance').innerText = Store.user.balance.toLocaleString();
                document.getElementById('user-avatar').src = Store.user.avatar;
                document.getElementById('role-badge').innerText = Store.user.role;

                if (Store.user.role === 'ADMIN') document.getElementById('admin-section').style.display = 'block';
                if (Store.user.role === 'ADMIN' || Store.user.role === 'AGENT') {
                    document.getElementById('extra-links').innerHTML = `<a href="agents.html" class="side-link">ğŸ¢ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</a>`;
                }

                // Activities list
                const txs = Store.getData('transactions');
                if (txs.length > 0) {
                    const list = document.getElementById('activities-list');
                    list.innerHTML = '';
                    txs.slice(0, 5).forEach(tx => {
                        list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #f8fafc; font-size:0.8rem; font-weight:800;">
                            <span>${tx.title}</span>
                            <span style="color:${tx.amount > 0 ? 'red' : 'green'}">${tx.amount > 0 ? '-' : '+'}${Math.abs(tx.amount)}</span>
                        </div>`;
                    });
                }
            }
        });

        function showResult(text, isSuccess) {
            const status = document.getElementById('admin-status');
            status.style.display = 'block';
            status.style.background = isSuccess ? '#dcfce7' : '#fee2e2';
            status.style.color = isSuccess ? '#16a34a' : '#dc2626';
            status.innerText = text;
        }

        function adminPoints(type) {
            const phone = document.getElementById('admin-phone').value;
            const points = parseInt(document.getElementById('admin-points').value);
            const currency = document.getElementById('admin-currency').value;

            if (!phone || isNaN(points)) return;

            const final = (type === 'UP') ? points : -points;
            const res = Store.updateUserBalance(phone, final, currency, "ØªØ­ÙƒÙ… Ø¥Ø¯Ø§Ø±ÙŠ Ù…Ø¨Ø§Ø´Ø±", Store.user.role);

            showResult(res.success ? "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­" : res.message, res.success);
            UI.updateNavbar();
        }

        function activateAgent() {
            const phone = document.getElementById('admin-phone').value;
            if (!phone) return;
            const res = Store.activateAgent(phone);
            showResult(res.message, res.success);
        }

        function approveDoctor() {
            const phone = document.getElementById('admin-phone').value;
            if (!phone) return;
            const res = Store.approveDoctor(phone);
            showResult(res.message, res.success);
        }

        function makeAdmin() {
            const phone = document.getElementById('admin-phone').value;
            if (!phone) return;
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŸ")) return;

            const res = Store.makeAdmin(phone);
            showResult(res.message, res.success);
        }

        function editDoctor() {
            const phone = document.getElementById('manage-doc-phone').value;
            const spec = document.getElementById('edit-doc-spec').value;
            const price = document.getElementById('edit-doc-price').value;

            if (!phone) return;
            const res = Store.editDoctor(phone, spec, price);
            showResult(res.message, res.success);
        }

        function deleteDoctor() {
            const phone = document.getElementById('manage-doc-phone').value;
            if (!phone) return;
            if (!confirm("Ø­Ø°Ù Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù„ØºØ§Ø¡ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡ ÙˆØ¥Ø²Ø§Ù„ØªÙ‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;

            const res = Store.deleteDoctor(phone);
            showResult(res.message, res.success);
        }
    </script>
</body>

</html>