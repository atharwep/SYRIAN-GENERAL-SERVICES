<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .sidebar {
            background: white;
            border-radius: 30px;
            padding: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.04);
            height: fit-content;
        }

        .side-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            text-decoration: none;
            color: #64748B;
            font-weight: 800;
            border-radius: 18px;
            transition: all 0.3s;
            margin-bottom: 5px;
        }

        .side-link:hover,
        .side-link.active {
            background: #F0F4F8;
            color: var(--gold);
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-panel {
            background: #1e293b;
            color: white;
            border-radius: 25px;
            padding: 30px;
            margin-top: 30px;
        }
    </style>
</head>

<body>

    <nav class="glass-nav">
        <a href="index.html" class="logo-container">
            <div class="logo-box">Ø¨</div>
            <div style="font-weight: 900; font-size: 18px;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
        </a>

        <div class="nav-links" id="nav-menu">
            <a href="dashboard.html" class="active">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <a href="doctors.html">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</a>
            <a href="taxi.html">Ø§Ù„Ù†Ù‚Ù„</a>
            <a href="wallet.html">Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
        </div>

        <div id="nav-right" style="display: flex; align-items: center; gap: 15px;"></div>

        <div class="menu-toggle" id="mobile-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="container sidebar-layout">
        <aside class="sidebar">
            <div style="text-align: center; margin-bottom: 30px;">
                <img id="user-avatar" src=""
                    style="width: 80px; height: 80px; border-radius: 20px; border: 3px solid var(--gold); margin-bottom: 15px;">
                <h3 id="user-name" style="font-weight: 950; font-size: 1.1rem;">...</h3>
                <span id="role-badge"
                    style="background: var(--gold); color: white; padding: 4px 12px; border-radius: 50px; font-size: 9px; font-weight: 900;"></span>
            </div>
            <a href="dashboard.html" class="side-link active">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="doctors.html" class="side-link">ğŸ©º Ø­Ø¬Ø² Ø·Ø¨ÙŠ</a>
            <a href="taxi.html" class="side-link">ğŸš• Ø·Ù„Ø¨ ØªØ§ÙƒØ³ÙŠ</a>
            <a href="wallet.html" class="side-link">ğŸ’³ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
            <div id="extra-links"></div>
            <hr style="margin: 15px 0; border: none; border-top: 1px solid rgba(0,0,0,0.05);">
            <button onclick="Auth.logout()" class="side-link"
                style="width: 100%; border: none; background: none; cursor: pointer; text-align: right;">ğŸšª
                Ø®Ø±ÙˆØ¬</button>
        </aside>

        <main>
            <div id="admin-section" style="display: none;">
                <!-- Points Control -->
                <div class="admin-panel" style="margin-top: 0;">
                    <h3 style="font-weight: 900; margin-bottom: 25px; color: var(--gold);">ğŸ”± ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù†Ù‚Ø§Ø· +
                        ÙˆÙƒÙ„Ø§Ø¡)</h3>

                    <div id="admin-status"
                        style="display: none; padding: 12px; border-radius: 12px; margin-bottom: 20px; font-weight: 800; font-size: 0.8rem; text-align: center;">
                    </div>

                    <!-- User Search -->
                    <div
                        style="background: rgba(255,255,255,0.02); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px;">
                        <h4 style="color: var(--gold); margin-bottom: 10px; font-weight: 900;">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…</h4>
                        <input type="text" id="user-search-input" class="form-input"
                            style="background: rgba(255,255,255,0.05); color: white;"
                            placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..." onkeyup="searchUserUI()">
                        <div id="user-search-results"
                            style="margin-top: 10px; display: none; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden;">
                        </div>
                    </div>

                    <div class="registration-form"
                        style="max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px;">
                        <div class="grid grid-2" style="gap: 15px;">
                            <div style="flex: 1.5;">
                                <input type="text" id="admin-phone" class="form-input"
                                    style="background: rgba(0,0,0,0.05); color: #000;" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
                                    oninput="lookupAdminUser(this.value)">
                                <div id="admin-user-preview"
                                    style="display:none; font-size: 0.7rem; font-weight: 800; color: #16a34a; margin-top: 5px; background: rgba(0,0,0,0.03); padding: 5px; border-radius: 8px;">
                                </div>
                            </div>
                            <input type="number" id="admin-points" class="form-input"
                                style="background: rgba(0,0,0,0.05); color: #000; height: 45px;" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                        </div>
                        <select id="admin-currency" class="form-input"
                            style="background: rgba(0,0,0,0.05); margin-top: 10px; color: #000;">
                            <option value="SYP">Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ© (SYP)</option>
                            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                        </select>

                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="adminPoints('UP')" class="btn btn-primary" style="flex: 1.5;">Ø¥ÙŠØ¯Ø§Ø¹ Ø±ØµÙŠØ¯
                                (+)</button>
                            <button onclick="adminPoints('DOWN')" class="btn"
                                style="flex: 1; background: #dc2626; color: white;">Ø³Ø­Ø¨ (-)</button>
                        </div>
                    </div>

                    <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

                    <!-- Pending Doctors -->
                    <div id="pending-doctors-section" style="display: none;">
                        <h4 style="color: #f59e0b; margin-bottom: 15px; font-weight: 900;">â³ Ø·Ù„Ø¨Ø§Øª Ø§Ù†Ø¶Ù…Ø§Ù… Ø£Ø·Ø¨Ø§Ø¡ (Ù…Ø¹Ù„Ù‚Ø©)
                        </h4>
                        <div id="pending-doctors-list"></div>
                        <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">
                    </div>

                    <!-- Doctor Management -->
                    <h4 style="color: var(--gold); margin-bottom: 15px; font-weight: 900;">ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h4>
                    <div
                        style="background: rgba(255,255,255,0.02); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05);">
                        <input type="text" id="manage-doc-phone" class="form-input"
                            style="background: rgba(255,255,255,0.05); color: white; margin-bottom: 10px;"
                            placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø¨ÙŠØ¨">

                        <div class="grid grid-2" style="gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="edit-doc-spec" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                            <input type="text" id="edit-doc-price" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù†ØµÙŠ)">
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button onclick="editDoctor()" class="btn btn-primary"
                                style="flex: 1; font-size: 0.8rem;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœï¸</button>
                            <button onclick="deleteDoctor()" class="btn"
                                style="flex: 1; background: #dc2626; color: white; font-size: 0.8rem;">Ø­Ø°Ù Ø§Ù„Ø·Ø¨ÙŠØ¨
                                ğŸ—‘ï¸</button>
                        </div>
                    </div>

                    <!-- Add New Doctor -->
                    <h4 style="color: var(--gold); margin: 25px 0 15px; font-weight: 900;">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯</h4>
                    <div
                        style="background: rgba(255,255,255,0.02); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px;">
                        <input type="text" id="new-doc-name" class="form-input"
                            style="background: rgba(255,255,255,0.05); color: white; margin-bottom: 10px;"
                            placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                        <div class="grid grid-2" style="gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="new-doc-phone" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                            <input type="text" id="new-doc-pass" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        </div>
                        <div class="grid grid-2" style="gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="new-doc-spec" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„ØªØ®ØµØµ">
                            <input type="text" id="new-doc-city" class="form-input"
                                style="background: rgba(255,255,255,0.05); color: white;" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
                        </div>
                        <input type="text" id="new-doc-price" class="form-input"
                            style="background: rgba(255,255,255,0.05); color: white; margin-bottom: 10px;"
                            placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù…Ø«Ø§Ù„: $20 Ø£Ùˆ 50000 Ù„.Ø³)">

                        <button onclick="addNewDoctor()" class="btn btn-primary" style="width: 100%;">ØªØ³Ø¬ÙŠÙ„ Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯
                            âœ¨</button>
                    </div>

                    <!-- Doctor Approval -->
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 25px;">
                        <p style="font-size: 0.85rem; font-weight: 800; color: #94a3b8; flex: 1;">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¹Ø¶Ùˆ ÙƒØ·Ø¨ÙŠØ¨:
                        </p>
                        <button onclick="approveDoctor()" class="btn"
                            style="background: #2563eb; color: white; padding: 12px 30px; border-radius: 15px;">Ø§Ø¹ØªÙ…Ø§Ø¯
                            Ø·Ø¨ÙŠØ¨ ğŸ©º</button>
                    </div>

                    <div style="display: flex; gap: 15px; align-items: center;">
                        <p style="font-size: 0.85rem; font-weight: 800; color: #94a3b8; flex: 1;">ØªÙØ¹ÙŠÙ„ Ø±ØªØ¨Ø© ÙˆÙƒÙŠÙ„ Ù„Ù‡Ø°Ø§
                            Ø§Ù„Ø±Ù‚Ù…:</p>
                        <button onclick="activateAgent()" class="btn"
                            style="background: #16a34a; color: white; padding: 12px 30px; border-radius: 15px;">ØªÙØ¹ÙŠÙ„
                            ÙƒÙˆÙƒÙŠÙ„ Ø±Ø³Ù…ÙŠ âœ…</button>
                    </div>

                    <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

                    <!-- Financial Reports Link -->
                    <a href="reports.html" class="btn"
                        style="display: block; width: 100%; text-align: center; background:rgba(255,255,255,0.1); color: white; margin-top: 15px;">
                        ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
                    </a>
                </div>
            </div>

            <div class="grid grid-2" style="margin-top: 30px; gap: 15px;">
                <div class="stat-card" style="display: block; padding: 20px;">
                    <p style="font-size: 0.7rem; font-weight: 800; color: #64748B; margin-bottom: 5px;">Ø±ØµÙŠØ¯ Ø§Ù„Ù„ÙŠØ±Ø©
                        Ø§Ù„Ø³ÙˆØ±ÙŠØ©</p>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 24px;">ğŸ‡¸ğŸ‡¾</div>
                        <h4 id="user-balance-syp" style="font-size: 1.2rem; font-weight: 950; color: var(--gold);">0
                        </h4>
                    </div>
                </div>
                <div class="stat-card" style="display: block; padding: 20px;">
                    <p style="font-size: 0.7rem; font-weight: 800; color: #64748B; margin-bottom: 5px;">Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)
                    </p>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 24px;">ğŸ‡ºğŸ‡¸</div>
                        <h4 id="user-balance-usd" style="font-size: 1.2rem; font-weight: 950; color: #3b82f6;">0</h4>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 25px;">
                <h3 style="font-weight: 900; margin-bottom: 20px;">ğŸ•’ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
                <div id="activities-list" style="text-align: center; padding: 20px; color: #64748B; font-weight: 700;">
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</div>
            </div>
        </main>
    </div>

    <!-- Doctor Details Modal -->
    <div id="doctorDetailsModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(10px); padding: 20px;">
        <div class="modal-content"
            style="background: #111; width: 100%; max-width: 500px; border-radius: 35px; border: 1px solid rgba(255,255,255,0.1); padding: 30px; position: relative; animation: slideUp 0.4s ease-out;">
            <button onclick="closeDoctorDetails()"
                style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <div id="doctorDetailsContent"></div>
        </div>
    </div>

    <style>
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        function showResult(text, isSuccess) {
            const status = document.getElementById('admin-status');
            status.style.display = 'block';
            status.style.background = isSuccess ? '#dcfce7' : '#fee2e2';
            status.style.color = isSuccess ? '#16a34a' : '#dc2626';
            status.innerText = text;
        }

        // Keeping these specific Admin Actions here or move to dashboard.js later
        // They are bound to HTML onclicks directly. Ideally should be in dashboard.js or auth.js
        // For now, keeping them global to avoid breakage until full migration.

        async function adminPoints(type) {
            const phone = document.getElementById('admin-phone').value;
            const points = parseInt(document.getElementById('admin-points').value);
            const currency = document.getElementById('admin-currency').value;

            if (!phone || isNaN(points)) return;

            // Find User Data
            const user = await Auth.findUserByPhone(phone);
            if (!user) {
                showResult("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…", false);
                return;
            }

            const actionText = (type === 'UP') ? 'Ø¥ÙŠØ¯Ø§Ø¹' : 'Ø³Ø­Ø¨';
            const amountText = `${points.toLocaleString()} ${currency}`;

            if (!confirm(`âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ù„ÙƒÙŠØ©:\n\nÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: ${actionText}\nØ§Ù„Ù…Ø³ØªÙ„Ù…: ${user.name}\nØ§Ù„Ø±Ù‚Ù…: ${phone}\nØ§Ù„Ù…Ø¨Ù„Øº: ${amountText}`)) {
                return;
            }

            const final = (type === 'UP') ? points : -points;
            const res = Store.updateUserBalance(phone, final, currency, "ØªØ­ÙƒÙ… Ø¥Ø¯Ø§Ø±ÙŠ Ù…Ø¨Ø§Ø´Ø±", Store.user.role);

            if (res.success) {
                showResult(`ØªÙ… ${actionText} ${amountText} Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${user.name} âœ…`, true);
                Notify.show("Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", `ØªÙ… ${actionText} Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù€ ${user.name} Ø¨Ù†Ø¬Ø§Ø­.`, "fas fa-cash-register");
            } else {
                showResult(res.message, false);
            }

            UI.updateNavbar();
        }

        async function lookupAdminUser(phone) {
            const preview = document.getElementById('admin-user-preview');
            if (phone.length === 10) {
                const user = await Auth.findUserByPhone(phone);
                if (user) {
                    preview.innerText = `ğŸ‘¤ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: ${user.name}`;
                    preview.style.display = 'block';
                    preview.style.color = '#16a34a';
                } else {
                    preview.innerText = `âŒ Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„`;
                    preview.style.display = 'block';
                    preview.style.color = '#dc2626';
                }
            } else {
                preview.style.display = 'none';
            }
        }

        // Search User UI Helper
        function searchUserUI() {
            const query = document.getElementById('user-search-input').value;
            const resultsDiv = document.getElementById('user-search-results');
            if (query.length < 2) { resultsDiv.style.display = 'none'; return; }
            const results = Store.searchUsers(query);
            if (results.length > 0) {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = results.map(u => `
                    <div onclick="selectUser('${u.phone}', '${u.name}')" 
                         style="padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s;"
                         onmouseover="this.style.background='rgba(255,255,255,0.1)'"
                         onmouseout="this.style.background='transparent'">
                        <div style="font-weight: bold; color: white;">${u.name}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">${u.phone} (${u.role})</div>
                    </div>
                `).join('');
            } else {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `<div style="padding: 10px; color: #94a3b8; text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>`;
            }
        }

        function selectUser(phone, name) {
            document.getElementById('admin-phone').value = phone;
            document.getElementById('manage-doc-phone').value = phone;
            document.getElementById('user-search-input').value = `${name} (${phone})`;
            document.getElementById('user-search-results').style.display = 'none';
        }
    </script>
</body>

</html>