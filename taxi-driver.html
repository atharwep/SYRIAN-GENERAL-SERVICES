<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ÙƒØ§Ø¨ØªÙ† - Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .stat-card-taxi {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-rgba);
            border-radius: 25px;
            padding: 20px;
            text-align: center;
        }

        .stat-card-taxi h2 {
            font-size: 2rem;
            font-weight: 950;
            color: var(--gold);
            margin: 5px 0;
        }

        .stat-card-taxi p {
            color: var(--text-muted);
            font-weight: 800;
            font-size: 0.8rem;
        }

        .request-item {
            background: rgba(197, 160, 33, 0.03);
            border: 1px solid var(--gold);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status-toggle {
            padding: 15px 30px;
            border-radius: 20px;
            font-weight: 950;
            cursor: pointer;
            transition: 0.3s;
            border: none;
        }

        .status-on {
            background: #10b981;
            color: white;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        .status-off {
            background: #334155;
            color: white;
        }
    </style>
</head>

<body class="royal-dark">
    <nav class="glass-nav">
        <a href="index.html" class="logo-container">
            <div class="logo-box">
                <img src="assets/logo.png" alt="Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ">
            </div>
            <div style="font-weight: 950; font-size: 19px; color: white;">Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ <span
                    style="font-size: 0.6rem; background: var(--gold); color: black; padding: 2px 8px; border-radius: 5px; margin-right: 5px;">ÙƒØ§Ø¨ØªÙ†</span>
            </div>
        </a>
        <div id="nav-right"></div>
    </nav>

    <div class="container" style="padding-top: 50px;">
        <div class="grid grid-3" style="margin-bottom: 40px; gap: 20px;">
            <div class="stat-card-taxi">
                <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</p>
                <h2 id="total-earnings">0</h2>
                <span style="color: #10b981; font-size: 0.7rem; font-weight: 950;">+12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
            </div>
            <div class="stat-card-taxi">
                <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª</p>
                <h2 id="trip-count">0</h2>
                <span style="color: var(--gold); font-size: 0.7rem; font-weight: 950;">â­ ØªÙ‚ÙŠÙŠÙ… 4.9</span>
            </div>
            <div class="stat-card-taxi" style="cursor: pointer;" onclick="toggleAvailability()">
                <p>Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</p>
                <button id="status-btn" class="status-toggle status-off">ØºÙŠØ± Ù…ØªØµÙ„</button>
            </div>
        </div>

        <div class="grid sidebar-layout">
            <main>
                <h3 style="color: white; font-weight: 950; margin-bottom: 25px;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© (Ø­ÙˆÙ„Ùƒ)</h3>
                <div id="requests-list">
                    <div style="text-align: center; color: var(--text-muted); padding: 60px 0;">
                        <i class="fas fa-toggle-off" style="font-size: 40px; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p style="font-weight: 800;">Ù‚Ù… Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                    </div>
                </div>
            </main>

            <aside>
                <div class="card">
                    <h3 style="color: white; font-weight: 900; margin-bottom: 20px;">Ø³Ø¬Ù„ Ø¢Ø®Ø± Ø§Ù„Ø±Ø­Ù„Ø§Øª</h3>
                    <div id="trip-history" style="max-height: 400px; overflow-y: auto;">
                        <!-- Dynamic -->
                        <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 20px;">Ù„Ø§
                            ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø±Ø­Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let isOnline = false;
        let currentDriver = null;

        document.addEventListener('DOMContentLoaded', () => {
            if (!Store.user) {
                window.location.href = 'login.html';
                return;
            }

            // Find driver record by current user phone
            const drivers = Store.getData('taxi_drivers') || [];
            currentDriver = drivers.find(d => d.phone === Store.user.phone);

            if (!currentDriver) {
                // Not a driver, redirect or show message
                document.body.innerHTML = `<div style="height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:20px;">
                    <h1 style="color:white; margin-bottom:20px;">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø£Ù†Øª Ù„Ø³Øª Ù…Ø³Ø¬Ù„Ø§Ù‹ ÙƒÙƒØ§Ø¨ØªÙ†</h1>
                    <a href="apply.html" class="btn btn-primary">Ø§Ù†Ø¶Ù… Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø§Ù„Ø¢Ù†</a>
                </div>`;
                return;
            }

            // Load Stats
            document.getElementById('total-earnings').innerText = currentDriver.trips * 15 + " Ù†";
            document.getElementById('trip-count').innerText = currentDriver.trips;

            if (currentDriver.status === 'AVAILABLE') {
                isOnline = true;
                updateStatusUI();
            }
        });

        function toggleAvailability() {
            isOnline = !isOnline;
            const drivers = Store.getData('taxi_drivers') || [];
            const idx = drivers.findIndex(d => d.id === currentDriver.id);
            if (idx !== -1) {
                drivers[idx].status = isOnline ? 'AVAILABLE' : 'OFFLINE';
                Store.setData('taxi_drivers', drivers);
            }
            updateStatusUI();

            if (isOnline) {
                Notify.show("Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ†", "Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…ØªØµÙ„ ÙˆØªØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ“¡", "fas fa-wifi");
                simulateNewRequest();
            } else {
                Notify.show("Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ†", "ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø±Ø§Ø­ØªÙƒ!", "fas fa-power-off");
                document.getElementById('requests-list').innerHTML = `<div style="text-align:center; color:gray; padding:50px;">Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
            }
        }

        function updateStatusUI() {
            const btn = document.getElementById('status-btn');
            btn.className = `status-toggle ${isOnline ? 'status-on' : 'status-off'}`;
            btn.innerText = isOnline ? 'Ù…ØªØµÙ„ ÙˆÙ…ØªØ§Ø­' : 'ØºÙŠØ± Ù…ØªØµÙ„';
        }

        function simulateNewRequest() {
            if (!isOnline) return;

            setTimeout(() => {
                const list = document.getElementById('requests-list');
                list.innerHTML = `
                    <div class="request-item">
                        <div>
                            <h4 style="color:white; font-weight:950; margin:0;">Ø±Ø­Ù„Ø© Ù…Ù„ÙƒÙŠØ© VIP</h4>
                            <p style="color:var(--text-muted); font-size:0.8rem; margin:5px 0;">Ù…Ù†: Ø§Ù„Ø³Ø¨Ø¹ Ø¨Ø­Ø±Ø§Øª</p>
                            <p style="color:var(--text-muted); font-size:0.8rem; margin:0;">Ø¥Ù„Ù‰: Ø§Ù„Ø±ÙˆØ¶Ø©ØŒ Ø¯Ù…Ø´Ù‚</p>
                        </div>
                        <div style="text-align:left;">
                            <p style="color:var(--gold); font-weight:950; font-size:1.2rem; margin:0;">25 Ù†Ù‚Ø·Ø©</p>
                            <p style="color:var(--text-muted); font-size:0.6rem; margin-bottom:10px;">Ø§Ù„Ù…Ø³Ø§ÙØ©: 2.5 ÙƒÙ…</p>
                            <div style="display:flex; gap:10px;">
                                <button class="btn" style="background:#10b981; color:white; padding:8px 15px; border-radius:10px; font-weight:900;" onclick="acceptTrip(this)">Ù‚Ø¨ÙˆÙ„</button>
                                <button class="btn" style="background:#ef4444; color:white; padding:8px 15px; border-radius:10px; font-weight:900;" onclick="this.parentElement.parentElement.parentElement.remove()">Ø±ÙØ¶</button>
                            </div>
                        </div>
                    </div>
                `;
                // Play sound simulation
                Notify.show("Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯! ğŸ””", "Ù‡Ù†Ø§Ùƒ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ ÙƒØ§Ø¨ØªÙ†", "fas fa-car");
            }, 3000);
        }

        function acceptTrip(btn) {
            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
            setTimeout(() => {
                Notify.show("Ù†Ø¬Ø§Ø­", "ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©! Ø§Ù†Ø·Ù„Ù‚ Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ ğŸš—", "fas fa-check-circle");
                btn.parentElement.parentElement.parentElement.innerHTML = `
                    <div style="text-align:center; width:100%;">
                        <h4 style="color:white; font-weight:950; margin-bottom:10px;">Ø§Ù„Ø±Ø­Ù„Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</h4>
                        <p style="color:var(--gold); font-size:0.8rem;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ (Ø§Ù„Ø³Ø¨Ø¹ Ø¨Ø­Ø±Ø§Øª)</p>
                        <button class="btn btn-primary" style="margin-top:15px; width:200px;" onclick="completeTrip(this)">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…</button>
                    </div>
                `;
            }, 1500);
        }

        function completeTrip(btn) {
            Notify.show("Ø´ÙƒØ±Ø§Ù‹ ÙƒØ§Ø¨ØªÙ†!", "ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„Ù…Ø­ÙØ¸ØªÙƒ ğŸ’°", "fas fa-coins");
            location.reload();
        }
    </script>
</body>

</html>